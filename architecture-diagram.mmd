---
title: "gRPC Project Template - Architecture & Dependencies"
config:
  flowchart:
    htmlLabels: false
    nodeSpacing: 30
    rankSpacing: 50
---
flowchart TB
    %% Build & Deploy Layer
    subgraph build ["ğŸ”¨ Build & Deploy"]
        direction LR
        MakefileCloudRun["Makefile.CloudRun-HelloService<br/>ğŸ“‹ Cloud Run Deploy"]
        Dockerfile["HelloService.Dockerfile<br/>ğŸ³ Multi-stage Build"]
        Makefile["Makefile<br/>âš™ï¸ Build Tools"]
        
        MakefileCloudRun -->|"build-docker"| Dockerfile
        Dockerfile -->|"make build"| Makefile
    end

    %% Entry Point
    subgraph entry ["ğŸš€ Entry Point"]
        MainGo["cmd/HelloService/main.go<br/>ğŸ¯ Application Entry"]
    end

    %% Configuration Layer  
    subgraph config ["âš™ï¸ Configuration"]
        ConfigEnv["config/deploy_env.go<br/>ğŸŒ Environment Config"]
        ConfigGrpc["config/grpc.go<br/>ğŸ“¡ gRPC Config"]
        ConfigFirebase["config/firebase_admin.go<br/>ğŸ”¥ Firebase Config"]
    end

    %% Application Layer (Business Logic)
    subgraph app ["ğŸ’¼ Application Layer"]
        HelloController["application/hello/controller.go<br/>ğŸ® Business Logic"]
        HelloLogging["application/hello/logging.go<br/>ğŸ“ Logging Decorator"]
        HelloValidation["application/hello/validation.go<br/>âœ… Input Validation"]
        HelloUtils["application/hello/utils.go<br/>ğŸ› ï¸ Helper Functions"]
    end

    %% Domain Layer (Entities & Interfaces)
    subgraph domain ["ğŸ›ï¸ Domain Layer"]
        HelloRepo["entity/hello/repository.go<br/>ğŸ“‹ Repository Interface"]
        HelloEntity["entity/hello/<br/>ğŸ¯ Domain Entity"]
        DbEntity["entity/db/example_table.go<br/>ğŸ—ƒï¸ Database Entity"]
        
        HelloRepo -.->|"implements"| HelloEntity
    end

    %% Infrastructure Layer
    subgraph infra ["ğŸ—ï¸ Infrastructure Layer"]
        direction TB
        
        subgraph transport ["ğŸš¦ Transport Layer"]
            GrpcHandler["transport/grpc/hello_service.go<br/>ğŸ“¡ gRPC Handler"]
            HttpHandler["transport/http/hello_service.go<br/>ğŸŒ HTTP Handler"]
            HttpModel["transport/http/model.go<br/>ğŸ“„ HTTP Models"]
        end
        
        subgraph database ["ğŸ—„ï¸ Database Layer"]
            MongoDb["mongodb/mongodb.go<br/>ğŸƒ MongoDB Connection"]
            MongoUtils["mongodb/utils.go<br/>ğŸ”§ MongoDB Utils"]
        end
        
        subgraph external ["ğŸŒ External Services"]
            CloudflareService["cloudflare/captcha.go<br/>â˜ï¸ Cloudflare Service"]
            FirebaseService["firebase/firebase-admin.go<br/>ğŸ”¥ Firebase Service"]
        end
    end

    %% Generated Code Layer
    subgraph generated ["ğŸ¤– Generated Code"]
        ProtobufHello["pb/hello/hello.pb.go<br/>ğŸ“ Proto Messages"]
        GrpcHello["pb/hello/hello_grpc.pb.go<br/>ğŸ“¡ gRPC Service"]
        ProtobufCommon["pb/common/standard.pb.go<br/>ğŸ“‹ Common Messages"]
    end

    %% Proto Definitions
    subgraph proto ["ğŸ“œ Proto Definitions"]
        ProtoHello["proto/hello/hello.proto<br/>ğŸ“ Service Definition"]
        ProtoCommon["proto/common/standard.proto<br/>ğŸ“‹ Common Types"]
    end

    %% Shared Packages
    subgraph pkg ["ğŸ“¦ Shared Packages"]
        PkgNet["pkg/net/<br/>ğŸŒ Network Utils"]
        PkgJwt["pkg/jwt/<br/>ğŸ” JWT Utils"] 
        PkgMongo["pkg/mongodb/<br/>ğŸƒ MongoDB Utils"]
        PkgLogger["pkg/logger/<br/>ğŸ“ Logger Utils"]
        PkgMain["pkg/grpc-project-template.go<br/>ğŸ“‹ Main Package"]
    end

    %% Mock Layer
    subgraph mock ["ğŸ­ Mock Layer"]
        MockCaptcha["mock/cloudflare_captcha_service.go<br/>ğŸ­ Mock Captcha"]
    end

    %% Dependencies Flow
    Makefile -->|"builds"| MainGo
    MainGo --> ConfigEnv
    MainGo --> ConfigGrpc  
    MainGo --> ConfigFirebase
    MainGo --> HelloController
    MainGo --> GrpcHandler
    MainGo --> HttpHandler
    MainGo --> MongoDb
    MainGo --> PkgNet
    MainGo --> PkgMain

    %% Application Layer Dependencies
    HelloController -->|"implements"| HelloRepo
        HelloController --> HelloLogging
        HelloLogging --> HelloRepo
        HelloController --> HelloValidation
        HelloController --> HelloUtils
    HelloController --> DbEntity
    HelloController --> ProtobufHello
    HelloController --> ProtobufCommon

    %% Transport Layer Dependencies
    GrpcHandler -->|"uses"| HelloRepo
        GrpcHandler --> PkgLogger
    GrpcHandler --> ProtobufHello
    HttpHandler -->|"uses"| HelloRepo
        HttpHandler --> PkgLogger
    HttpHandler --> ProtobufHello
    HttpHandler --> HttpModel
    HttpHandler --> PkgNet

    %% Infrastructure Dependencies
    MongoDb --> PkgMongo
    MongoDb --> DbEntity
    CloudflareService --> MockCaptcha
    FirebaseService --> ConfigFirebase

    %% Proto Generation
    ProtoHello -->|"protoc generates"| ProtobufHello
    ProtoHello -->|"protoc generates"| GrpcHello
    ProtoCommon -->|"protoc generates"| ProtobufCommon

    %% Styling
    classDef buildLayer fill:#FFE4E1,stroke:#FF6B6B,stroke-width:2px
    classDef appLayer fill:#E8F5E8,stroke:#4CAF50,stroke-width:2px
    classDef domainLayer fill:#E3F2FD,stroke:#2196F3,stroke-width:2px
    classDef infraLayer fill:#FFF3E0,stroke:#FF9800,stroke-width:2px
    classDef protoLayer fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px
    classDef pkgLayer fill:#E0F2F1,stroke:#009688,stroke-width:2px
    classDef mockLayer fill:#FFFDE7,stroke:#FFC107,stroke-width:2px

    class build buildLayer
    class entry,config appLayer
    class domain domainLayer
    class infra infraLayer
    class generated,proto protoLayer
    class pkg pkgLayer
    class mock mockLayer
